const questions = [
  {
    "id": 1,
    "type": "dropdown",
    "prompt": "Q1. Match the term \u2018Agent\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "E",
    "explanation": "An agent is any microorganism or factor essential for disease occurrence.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 2,
    "type": "dropdown",
    "prompt": "Q2. Match the term \u2018Reservoir\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "J",
    "explanation": "The reservoir is the habitat where the agent lives, grows, and multiplies.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 3,
    "type": "dropdown",
    "prompt": "Q3. Match the term \u2018Incubation Period\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "C",
    "explanation": "Incubation period is the time from exposure to symptom onset.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 4,
    "type": "dropdown",
    "prompt": "Q4. Match the term \u2018Attack Rate\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "H",
    "explanation": "Attack rate is the proportion of susceptible individuals who become ill in an outbreak.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 5,
    "type": "dropdown",
    "prompt": "Q5. Match the term \u2018Vector\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "F",
    "explanation": "A vector is an animate intermediary that transmits an agent.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 6,
    "type": "dropdown",
    "prompt": "Q6. Match the term \u2018Fomite\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "A",
    "explanation": "A fomite is a non-living object capable of transmitting infection.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 7,
    "type": "dropdown",
    "prompt": "Q7. Match the term \u2018Case Fatality Rate\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "B",
    "explanation": "CFR is the proportion of infected individuals who die.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 8,
    "type": "dropdown",
    "prompt": "Q8. Match the term \u2018Endemic\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "D",
    "explanation": "Endemic means a disease is constantly present in a population.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 9,
    "type": "dropdown",
    "prompt": "Q9. Match the term \u2018Droplet Nuclei\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "G",
    "explanation": "Droplet nuclei are dried residues that can remain airborne and be inhaled.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 10,
    "type": "dropdown",
    "prompt": "Q10. Match the term \u2018Incidence Rate\u2019 to the correct definition letter.",
    "options": [
      "A",
      "B",
      "C",
      "D",
      "E",
      "F",
      "G",
      "H",
      "I",
      "J"
    ],
    "correct": "I",
    "explanation": "Incidence rate quantifies new cases over time per population.",
    "graded": true,
    "meta": {
      "definitions": {
        "A": "Non-living object that can transmit infection (fomite).",
        "B": "Proportion of infected individuals who die from the disease (case fatality rate).",
        "C": "Time between exposure and onset of symptoms (incubation period).",
        "D": "Constant presence of a disease in a population (endemic).",
        "E": "A microorganism or factor essential for disease occurrence (agent).",
        "F": "Animate intermediary transmitting an agent (vector).",
        "G": "Residue of dried droplets that remain airborne (droplet nuclei).",
        "H": "Proportion of susceptible individuals who become ill during an outbreak (attack rate).",
        "I": "Rate of new cases in a population over a time period (incidence rate).",
        "J": "Habitat where an agent lives and multiplies (reservoir)."
      }
    }
  },
  {
    "id": 11,
    "type": "mc",
    "prompt": "Q11. Which measure best describes the risk of developing disease in a population?",
    "options": [
      "Prevalence",
      "Incidence",
      "Mortality rate",
      "Case fatality rate"
    ],
    "correct": "Incidence",
    "explanation": "Incidence counts new cases over time and reflects risk of developing disease.",
    "graded": true
  },
  {
    "id": 12,
    "type": "mc",
    "prompt": "Q12. Which of the following is an example of direct transmission?",
    "options": [
      "Mosquito bite",
      "Touching contaminated surfaces",
      "Sneezing on someone",
      "Eating contaminated food"
    ],
    "correct": "Sneezing on someone",
    "explanation": "Sneezing on someone spreads large droplets directly to another person.",
    "graded": true
  },
  {
    "id": 13,
    "type": "mc",
    "prompt": "Q13. Which study design is best for rare diseases?",
    "options": [
      "Cohort",
      "Case-control",
      "Cross-sectional",
      "Randomized trial"
    ],
    "correct": "Case-control",
    "explanation": "Case-control studies start from cases and are efficient for rare outcomes.",
    "graded": true
  },
  {
    "id": 14,
    "type": "mc",
    "prompt": "Q14. A nested cohort study is:",
    "options": [
      "A case-control study within a cohort",
      "A cohort within a larger cohort",
      "A randomized trial within a cohort",
      "None of the above"
    ],
    "correct": "A case-control study within a cohort",
    "explanation": "Nested case-control selects cases and controls from a defined cohort.",
    "graded": true
  },
  {
    "id": 15,
    "type": "mc",
    "prompt": "Q15. Which bias occurs when participants drop out of a study?",
    "options": [
      "Recall bias",
      "Attrition bias",
      "Selection bias",
      "Interview bias"
    ],
    "correct": "Attrition bias",
    "explanation": "Attrition bias arises from differential loss to follow-up.",
    "graded": true
  },
  {
    "id": 16,
    "type": "mc",
    "prompt": "Q16. Which term describes multiple epidemics interacting synergistically?",
    "options": [
      "Syndemic",
      "Pandemic",
      "Endemic",
      "Hyperendemic"
    ],
    "correct": "Syndemic",
    "explanation": "A syndemic involves co-occurring epidemics that exacerbate each other.",
    "graded": true
  },
  {
    "id": 17,
    "type": "mc",
    "prompt": "Q17. Which surveillance approach commonly uses wastewater monitoring?",
    "options": [
      "Passive",
      "Active",
      "Syndromic",
      "Sentinel"
    ],
    "correct": "Syndromic",
    "explanation": "Wastewater monitoring is a syndromic approach using proxies of disease activity.",
    "graded": true
  },
  {
    "id": 18,
    "type": "mc",
    "prompt": "Q18. Which of the following is NOT a component of the chain of infection?",
    "options": [
      "Agent",
      "Reservoir",
      "Vector",
      "Odds ratio"
    ],
    "correct": "Odds ratio",
    "explanation": "Odds ratio is an analytic measure, not a chain component.",
    "graded": true
  },
  {
    "id": 19,
    "type": "mc",
    "prompt": "Q19. Which measure is used in case-control studies?",
    "options": [
      "Relative Risk",
      "Odds Ratio",
      "Incidence Rate",
      "Attack Rate"
    ],
    "correct": "Odds Ratio",
    "explanation": "Odds ratio estimates association when incidence is not available.",
    "graded": true
  },
  {
    "id": 20,
    "type": "mc",
    "prompt": "Q20. Which is an example of horizontal transmission?",
    "options": [
      "Mother to child during birth",
      "Sexual contact between adults",
      "Genetic inheritance",
      "Breastfeeding"
    ],
    "correct": "Sexual contact between adults",
    "explanation": "Horizontal transmission occurs between individuals (not parent-to-child).",
    "graded": true
  },
  {
    "id": 21,
    "type": "mc",
    "prompt": "Q21. Influenza pandemics have originated from:",
    "options": [
      "Avian influenza viruses",
      "Bats",
      "Arthropods",
      "Rodents"
    ],
    "correct": "Avian influenza viruses",
    "explanation": "Pandemic strains carry avian-origin segments (e.g., HA).",
    "graded": true
  },
  {
    "id": 22,
    "type": "mc",
    "prompt": "Q22. Which prevention level aims to avoid unnecessary medical interventions?",
    "options": [
      "Primary",
      "Secondary",
      "Tertiary",
      "Quaternary"
    ],
    "correct": "Quaternary",
    "explanation": "Quaternary prevention reduces overmedicalization and harm.",
    "graded": true
  },
  {
    "id": 23,
    "type": "mc",
    "prompt": "Q23. A person infected but asymptomatic is called a:",
    "options": [
      "Carrier",
      "Reservoir",
      "Vector",
      "Host"
    ],
    "correct": "Carrier",
    "explanation": "Carriers can transmit disease without symptoms.",
    "graded": true
  },
  {
    "id": 24,
    "type": "mc",
    "prompt": "Q24. Which of the following is a sentinel surveillance system?",
    "options": [
      "RESP-NET",
      "NNDSS",
      "Wastewater monitoring",
      "Hospital discharge database"
    ],
    "correct": "RESP-NET",
    "explanation": "RESP-NET conducts active, sentinel surveillance for respiratory infections.",
    "graded": true
  },
  {
    "id": 25,
    "type": "mc",
    "prompt": "Q25. Which is a limitation of passive surveillance?",
    "options": [
      "High cost",
      "Underreporting",
      "Requires active case finding",
      "Provides real-time data"
    ],
    "correct": "Underreporting",
    "explanation": "Passive relies on voluntary reports and often misses cases.",
    "graded": true
  },
  {
    "id": 26,
    "type": "short",
    "prompt": "Q26. Define latent infection and give one example.",
    "options": null,
    "correct": null,
    "explanation": "A latent infection is the presence of a pathogen without symptoms (subclinical). Examples: TB, Herpes, EBV, Varicella Zoster.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 27,
    "type": "short",
    "prompt": "Q27. Explain why vaccination may not be effective against latent infections.",
    "options": null,
    "correct": null,
    "explanation": "Latency can hide pathogens from immune detection; vaccination is preventive before infection. Suppressive therapy keeps latency/controls reactivation.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 28,
    "type": "short",
    "prompt": "Q28. Draw or list the chain of infection for tuberculosis.",
    "options": null,
    "correct": null,
    "explanation": "Agent: Mycobacterium tuberculosis \u2192 Reservoir: humans (lungs) \u2192 Portal of exit: respiratory tract \u2192 Mode: respiratory droplets \u2192 Portal of entry: respiratory tract \u2192 Susceptible host.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 29,
    "type": "short",
    "prompt": "Q29. Name two ways to break the chain of infection for diphtheria.",
    "options": null,
    "correct": null,
    "explanation": "Vaccination (Tdap); antibiotics/antitoxin; isolation; hygiene; masks and droplet precautions.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 30,
    "type": "short",
    "prompt": "Q30. What is an epi curve and what does it show?",
    "options": null,
    "correct": null,
    "explanation": "An epidemic curve is a histogram of cases by time of onset. It shows outbreak pattern and timing (point source vs propagated).",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 31,
    "type": "short",
    "prompt": "Q31. What type of propagation does a propagated outbreak indicate?",
    "options": null,
    "correct": "Person-to-person",
    "explanation": "Person-to-person transmission with successive waves.",
    "graded": true,
    "shortMode": "text"
  },
  {
    "id": 32,
    "type": "short",
    "prompt": "Q32. What is a case definition and why is it important?",
    "options": null,
    "correct": null,
    "explanation": "Standard clinical/lab/time-place-person criteria to classify cases consistently and avoid misclassification.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 33,
    "type": "short",
    "prompt": "Q33. Give two examples of bias in epidemiological studies.",
    "options": null,
    "correct": null,
    "explanation": "Examples: recall bias; selection bias; attrition bias; interview bias; Hawthorne effect.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 34,
    "type": "short",
    "prompt": "Q34. In a DAG, what is a collider?",
    "options": null,
    "correct": "Collider",
    "explanation": "A variable affected by two (or more) other variables. Conditioning on it can induce spurious association.",
    "graded": true,
    "shortMode": "text"
  },
  {
    "id": 35,
    "type": "short",
    "prompt": "Q35. In a DAG, what does \u201cU\u201d represent? Give an example.",
    "options": null,
    "correct": null,
    "explanation": "U denotes an unknown/unmeasured common cause (confounder), e.g., parental mental health, socioeconomic context.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 36,
    "type": "short",
    "prompt": "Q36. Calculate the attack rate: 40 people attended a picnic, 10 became ill. Provide %.",
    "explanation": "Attack rate = (ill / at risk) \u00d7 100 = (10/40)\u00d7100 = 25%.",
    "graded": true,
    "shortMode": "number",
    "correct": 25.0,
    "tolerance": 1.0
  },
  {
    "id": 37,
    "type": "short",
    "prompt": "Q37. Calculate the odds ratio (OR): Ill: Ate salad (15), Did not (5); Not ill: Ate salad (20), Did not (30).",
    "explanation": "OR = (15\u00d730)/(20\u00d75) = 450/100 = 4.5.",
    "graded": true,
    "shortMode": "number",
    "correct": 4.5,
    "tolerance": 0.05
  },
  {
    "id": 38,
    "type": "short",
    "prompt": "Q38. Calculate incidence rate: 50 new cases in a population of 10,000 over 1 year (per 1,000/year).",
    "explanation": "Incidence = (50/10,000)\u00d71,000 = 5 per 1,000/year.",
    "graded": true,
    "shortMode": "number",
    "correct": 5.0,
    "tolerance": 0.1
  },
  {
    "id": 39,
    "type": "short",
    "prompt": "Q39. Calculate prevalence: 200 cases in a population of 5,000 (as %).",
    "explanation": "Prevalence = (200/5,000)\u00d7100 = 4%.",
    "graded": true,
    "shortMode": "number",
    "correct": 4.0,
    "tolerance": 0.1
  },
  {
    "id": 40,
    "type": "short",
    "prompt": "Q40. A point source epi curve typically shows what pattern?",
    "explanation": "Point source outbreaks show a sharp peak with most cases in a short interval.",
    "graded": true,
    "shortMode": "text",
    "correctText": "Sharp single peak clustered in time"
  },
  {
    "id": 41,
    "type": "short",
    "prompt": "Q41. Construct a 2\u00d72 test table: sensitivity 90%, specificity 80%. What % are false negatives?",
    "explanation": "Sensitivity 90% \u21d2 10% false negatives among truly positive.",
    "graded": true,
    "shortMode": "number",
    "correct": 10.0,
    "tolerance": 0.0
  },
  {
    "id": 42,
    "type": "short",
    "prompt": "Q42. If a test misses 10% of true positives, what is its sensitivity (%)?",
    "explanation": "Sensitivity = 100% \u2212 10% = 90%.",
    "graded": true,
    "shortMode": "number",
    "correct": 90.0,
    "tolerance": 0.0
  },
  {
    "id": 43,
    "type": "short",
    "prompt": "Q43. Compute relative risk (RR): Attack rate exposed = 30%, unexposed = 10%.",
    "explanation": "RR = 0.30 / 0.10 = 3.0.",
    "graded": true,
    "shortMode": "number",
    "correct": 3.0,
    "tolerance": 0.0
  },
  {
    "id": 44,
    "type": "short",
    "prompt": "Q44. Period prevalence concept: Given cases/population. What formula defines period prevalence?",
    "explanation": "Period prevalence = total cases during the time interval \u00f7 population at risk (often mid-period).",
    "graded": true,
    "shortMode": "text",
    "correctText": "Cases during period / population at mid-period"
  },
  {
    "id": 45,
    "type": "short",
    "prompt": "Q45. Why use odds ratio in case-control studies rather than relative risk?",
    "explanation": "In case-control designs, sampling is based on outcome, so incidence cannot be computed; OR estimates association and \u2248 RR when rare.",
    "graded": true,
    "shortMode": "text",
    "correctText": "Incidence not available; OR approximates RR when disease is rare"
  },
  {
    "id": 46,
    "type": "mc",
    "prompt": "Q46. What study type is best for investigating a foodborne outbreak after exposure?",
    "options": [
      "Cohort",
      "Case-control",
      "Cross-sectional",
      "Randomized trial"
    ],
    "correct": "Case-control",
    "explanation": "Exposure already occurred; case-control is efficient and cost-effective.",
    "graded": true
  },
  {
    "id": 47,
    "type": "short",
    "prompt": "Q47. Write a confirmed case definition for a Salmonella outbreak at a restaurant.",
    "explanation": "Example: Laboratory-confirmed Salmonella infection + compatible illness + ate at the restaurant during [dates] in [location]. Include person/place/time.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 48,
    "type": "short",
    "prompt": "Q48. Name two CDC respiratory surveillance systems and their data collection type.",
    "explanation": "Examples: RESP-NET (active/sentinel), COVID-NET (population-based, active), FluSurv-NET (passive in some contexts).",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 49,
    "type": "short",
    "prompt": "Q49. Explain how wastewater monitoring tracks SARS-CoV-2.",
    "explanation": "Infected individuals shed viral RNA in feces; wastewater sampling quantifies RNA trends to infer community transmission, regardless of symptoms.",
    "graded": false,
    "shortMode": "text"
  },
  {
    "id": 50,
    "type": "short",
    "prompt": "Q50. Give two advantages and two disadvantages of DAGs in epidemiology.",
    "explanation": "Advantages: clarify causal pathways; identify confounding/selection bias; simple to construct. Disadvantages: no effect size; cannot detect measurement error; limited depiction of interaction.",
    "graded": false,
    "shortMode": "text"
  }
];

// (rest of app code appended)
let current = 0;
let gradedCorrect = 0;
let gradedTotal = 0;

function setProgress() {
  const qNumEl = document.getElementById('qNum');
  const qTotalEl = document.getElementById('qTotal');
  const fill = document.getElementById('barFill');
  qNumEl.textContent = current + 1;
  qTotalEl.textContent = questions.length;
  fill.style.width = (((current) / (questions.length)) * 100).toFixed(1) + '%';
}

function renderDefinitions(defs) {
  const panel = document.getElementById('definitionsPanel');
  const list = document.getElementById('definitionsList');
  if (!defs) { panel.open = false; panel.classList.add('hidden'); return; }
  panel.classList.remove('hidden');
  list.innerHTML = Object.entries(defs).map(([k,v]) => `<p><strong>${k}.</strong> ${v}</p>`).join('');
}

function renderQuestion() {
  const q = questions[current];
  setProgress();
  document.getElementById('feedback').classList.add('hidden');
  document.getElementById('feedback').innerHTML = '';
  document.getElementById('nextBtn').disabled = true;

  const promptEl = document.getElementById('questionPrompt');
  promptEl.textContent = q.prompt;

  renderDefinitions(q.meta?.definitions);

  const area = document.getElementById('responseArea');
  area.innerHTML = '';

  if (q.type === 'mc') {
    q.options.forEach(opt => {
      const id = 'opt_' + Math.random().toString(36).slice(2);
      const wrapper = document.createElement('div');
      wrapper.className = 'radioOption';
      const input = document.createElement('input');
      input.type = 'radio'; input.name = 'mc'; input.value = opt; input.id = id;
      const label = document.createElement('label');
      label.setAttribute('for', id);
      label.textContent = opt;
      wrapper.appendChild(input); wrapper.appendChild(label);
      area.appendChild(wrapper);
    });
  } else if (q.type === 'dropdown') {
    const select = document.createElement('select');
    select.id = 'ddSelect';
    const blank = document.createElement('option'); blank.value = ''; blank.textContent = '— Select letter —';
    select.appendChild(blank);
    q.options.forEach(letter => {
      const o = document.createElement('option'); o.value = letter; o.textContent = letter; select.appendChild(o);
    });
    area.appendChild(select);
    const note = document.createElement('small'); note.className = 'note';
    note.textContent = 'Tip: open definitions A–J above to view full statements.';
    area.appendChild(note);
  } else if (q.type === 'short') {
    if (q.shortMode === 'number') {
      const input = document.createElement('input'); input.type = 'number'; input.id = 'shortNum'; input.step = 'any';
      area.appendChild(input);
    } else {
      const textarea = document.createElement('textarea'); textarea.id = 'shortText';
      area.appendChild(textarea);
    }
  }
}

function normalize(s) { return (s || '').toString().trim().toLowerCase(); }

function checkAnswer(ev) {
  ev.preventDefault();
  const q = questions[current];
  const fb = document.getElementById('feedback');
  fb.classList.remove('hidden');

  let userAns = null, correct = false, userDisplay = '';

  if (q.type === 'mc') {
    const sel = document.querySelector('input[name="mc"]:checked');
    userAns = sel ? sel.value : ''; userDisplay = userAns || '(no selection)';
    correct = (userAns === q.correct);
  } else if (q.type === 'dropdown') {
    const sel = document.getElementById('ddSelect');
    userAns = sel ? sel.value : ''; userDisplay = userAns || '(no selection)';
    correct = (userAns === q.correct);
  } else if (q.type === 'short') {
    if (q.shortMode === 'number') {
      const val = document.getElementById('shortNum').value;
      userAns = parseFloat(val); userDisplay = (val === '' ? '(no entry)' : val);
      if (!isNaN(userAns)) {
        const diff = Math.abs(userAns - q.correct);
        correct = diff <= (q.tolerance || 0);
      } else { correct = false; }
    } else {
      const val = document.getElementById('shortText').value; userDisplay = val || '(no entry)';
      if (q.graded && q.correct) { correct = normalize(val) === normalize(q.correct); }
      else { correct = true; }
    }
  }

  if (q.graded) { gradedTotal += 1; if (correct) gradedCorrect += 1; }

  fb.innerHTML = `
    <div class="${correct ? 'correct' : 'incorrect'}">
      <h3>${correct ? '✅ Correct' : '❌ Not quite'}</h3>
      <p><strong>Your answer:</strong> ${userDisplay}</p>
      <p><strong>Correct answer:</strong> ${q.type === 'short' && q.shortMode !== 'number' && q.correctText ? q.correctText : (q.correct || '(see explanation)')}</p>
      <p><strong>Explanation:</strong> ${q.explanation}</p>
    </div>`;

  document.getElementById('nextBtn').disabled = false;
}

function nextQuestion() {
  if (current < questions.length - 1) { current += 1; renderQuestion(); }
  else {
    document.getElementById('questionContainer').classList.add('hidden');
    const sum = document.getElementById('summary'); sum.classList.remove('hidden');
    document.getElementById('correctCount').textContent = gradedCorrect;
    document.getElementById('gradedCount').textContent = gradedTotal;
    document.getElementById('barFill').style.width = '100%';
    document.getElementById('progressText').textContent = 'Completed';
  }
}

function prevQuestion() { if (current > 0) { current -= 1; renderQuestion(); } }
function restart() {
  current = 0; gradedCorrect = 0; gradedTotal = 0;
  document.getElementById('summary').classList.add('hidden');
  document.getElementById('questionContainer').classList.remove('hidden');
  renderQuestion();
}

function init() {
  renderQuestion();
  document.getElementById('responseForm').addEventListener('submit', checkAnswer);
  document.getElementById('nextBtn').addEventListener('click', nextQuestion);
  document.getElementById('prevBtn').addEventListener('click', prevQuestion);
  document.getElementById('restartBtn').addEventListener('click', restart);
}

document.addEventListener('DOMContentLoaded', init);
